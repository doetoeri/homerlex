<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Homerlex</title>
  <!-- Pretendard 폰트 로드 (출처: Pretendard GitHub) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pretendard/dist/web/static/pretendard.css">
  <style>
    /* 기본 스타일 */
    body {
      font-family: 'Pretendard', sans-serif;
      background: linear-gradient(135deg, #e0e5ec, #f0f0f3);
      margin: 0;
      padding: 20px;
    }
    .toolbar {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
      align-items: center;
    }
    .toolbar button {
      padding: 10px 20px;
      border: none;
      border-radius: 10px;
      background: #e0e5ec;
      box-shadow: 5px 5px 10px #a3b1c6, -5px -5px 10px #ffffff;
      cursor: pointer;
      font-size: 14px;
      font-family: 'Pretendard', sans-serif;
      font-weight: 600; /* Pretendard Semibold */
      outline: none;
      transition: box-shadow 0.2s ease;
    }
    .toolbar button:hover {
      box-shadow: inset 5px 5px 10px #a3b1c6, inset -5px -5px 10px #ffffff;
    }
    /* 원형 컬러피커 */
    .toolbar input[type="color"] {
      width: 40px;
      height: 40px;
      border: none;
      border-radius: 50%;
      padding: 0;
      margin-left: 10px;
      cursor: pointer;
      background: transparent;
    }
    /* 저장 확장자 선택 */
    .toolbar select {
      padding: 8px;
      border: none;
      border-radius: 10px;
      background: #e0e5ec;
      box-shadow: 5px 5px 10px #a3b1c6, -5px -5px 10px #ffffff;
      font-family: 'Pretendard', sans-serif;
      font-weight: 600;
      outline: none;
      cursor: pointer;
    }
    .editor {
      width: 100%;
      height: 400px;
      border: none;
      border-radius: 20px;
      padding: 20px;
      background: rgba(255, 255, 255, 0.1);
      box-shadow: inset 5px 5px 10px #a3b1c6, inset -5px -5px 10px #ffffff;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.3);
      overflow: auto;
      position: relative;
    }
    /* Bold 텍스트 강제 Pretendard Semibold */
    .editor b,
    .editor strong {
      font-weight: 600;
    }
    /* Fluent Design 스타일의 하이라이트 (기본) */
    .highlight {
      border-radius: 8px;
      padding: 2px 4px;
      backdrop-filter: blur(6px);
      -webkit-backdrop-filter: blur(6px);
      position: relative;
    }
  </style>
</head>
<body>
  <div class="toolbar">
    <button id="btnBold" title="Bold (Ctrl+B)">Bold</button>
    <button id="btnUnderline" title="Underline (Ctrl+U)">Underline</button>
    <button id="btnHighlight" title="Apply Highlight (Ctrl+H)">Highlight</button>
    <button id="btnRemoveHighlight" title="Remove Highlight (Ctrl+R)">Remove Highlight</button>
    <!-- 원형 컬러피커: 하이라이트 색상 선택 -->
    <input type="color" id="colorHighlight" title="Choose Highlight Color" value="#007AFF">
    <!-- 저장 확장자 선택 -->
    <select id="saveType" title="Save as (Ctrl+S)">
      <option value="txt">TXT</option>
      <option value="hom" selected>HOM</option>
    </select>
    <button id="btnSave" title="Save (Ctrl+S)">Save</button>
    <button id="btnUndo" title="Undo (Ctrl+Z)">Undo</button>
    <button id="btnRedo" title="Redo (Ctrl+Y)">Redo</button>
    <button id="btnLoad" title="Load File (Ctrl+O)">Load</button>
    <!-- 숨김 파일 입력: HOM/TXT 파일 불러오기 -->
    <input type="file" id="fileLoad" accept=".hom,.txt" style="display: none;">
  </div>

  <div class="editor" contenteditable="true" id="editor">
    여기에 메모를 입력하세요...
  </div>

  <script>
    // 헬퍼 함수: HEX 값을 rgba 문자열로 변환 (alpha 포함)
    function hexToRgba(hex, alpha) {
      hex = hex.replace('#', '');
      if (hex.length === 3) {
        hex = hex.split('').map(c => c + c).join('');
      }
      const r = parseInt(hex.substring(0, 2), 16);
      const g = parseInt(hex.substring(2, 4), 16);
      const b = parseInt(hex.substring(4, 6), 16);
      return `rgba(${r}, ${g}, ${b}, ${alpha})`;
    }
    
    // 하이라이트 스타일 업데이트 (선택한 컬러에 따라)
    function updateHighlightStyle(element) {
      const color = document.getElementById('colorHighlight').value;
      element.style.backgroundColor = hexToRgba(color, 0.2);
      element.style.boxShadow = `0px 0px 12px ${hexToRgba(color, 0.4)}`;
      element.style.border = `1px solid ${hexToRgba(color, 0.3)}`;
      element.style.color = '#000';
    }
    
    // 하이라이트 적용: 이미 하이라이트된 경우 업데이트, 아니면 새로 래핑
    function applyHighlight() {
      const selection = window.getSelection();
      if (selection.isCollapsed) return;
      const range = selection.getRangeAt(0);
      let container = range.commonAncestorContainer;
      if (container.nodeType === Node.TEXT_NODE) {
        container = container.parentElement;
      }
      if (container && container.classList && container.classList.contains('highlight')) {
        // 이미 하이라이트된 영역이면 색상 업데이트
        updateHighlightStyle(container);
        selection.removeAllRanges();
        return;
      }
      const span = document.createElement('span');
      span.className = 'highlight';
      updateHighlightStyle(span);
      span.appendChild(range.extractContents());
      range.insertNode(span);
      selection.removeAllRanges();
    }
    
    // 하이라이트 해제: 선택된 영역이 하이라이트인 경우 태그 제거
    function removeHighlight() {
      const selection = window.getSelection();
      if (selection.isCollapsed) return;
      const range = selection.getRangeAt(0);
      let container = range.commonAncestorContainer;
      if (container.nodeType === Node.TEXT_NODE) {
        container = container.parentElement;
      }
      if (container && container.classList && container.classList.contains('highlight')) {
        const parent = container.parentNode;
        while (container.firstChild) {
          parent.insertBefore(container.firstChild, container);
        }
        parent.removeChild(container);
        selection.removeAllRanges();
      }
    }
    
    // 저장 기능: 선택한 확장자에 따라 저장 (TXT: innerText, HOM: innerHTML)
    function saveContent() {
      const editor = document.getElementById('editor');
      const ext = document.getElementById('saveType').value;
      let content = '';
      if (ext === 'txt') {
        content = editor.innerText;
      } else if (ext === 'hom') {
        content = editor.innerHTML;
      }
      const blob = new Blob([content], { type: 'text/plain' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = `homerlex_note.${ext}`;
      a.click();
      URL.revokeObjectURL(a.href);
    }
    
    // 파일 불러오기: HOM/TXT 파일 읽어서 에디터에 로드
    function loadFile(event) {
      const file = event.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function(e) {
        const ext = file.name.split('.').pop().toLowerCase();
        // HOM 파일은 HTML 형식으로, TXT 파일은 텍스트로 처리
        if (ext === 'hom') {
          document.getElementById('editor').innerHTML = e.target.result;
        } else if (ext === 'txt') {
          document.getElementById('editor').innerText = e.target.result;
        }
      };
      reader.readAsText(file);
    }
    
    // 버튼 클릭 이벤트
    document.getElementById('btnBold').addEventListener('click', () => document.execCommand('bold'));
    document.getElementById('btnUnderline').addEventListener('click', () => document.execCommand('underline'));
    document.getElementById('btnHighlight').addEventListener('click', applyHighlight);
    document.getElementById('btnRemoveHighlight').addEventListener('click', removeHighlight);
    document.getElementById('btnSave').addEventListener('click', saveContent);
    document.getElementById('btnUndo').addEventListener('click', () => document.execCommand('undo'));
    document.getElementById('btnRedo').addEventListener('click', () => document.execCommand('redo'));
    document.getElementById('btnLoad').addEventListener('click', () => document.getElementById('fileLoad').click());
    document.getElementById('fileLoad').addEventListener('change', loadFile);
    
    // 단축키 지원: Ctrl+B, Ctrl+U, Ctrl+H, Ctrl+R, Ctrl+S, Ctrl+O, Ctrl+Z, Ctrl+Y
    document.addEventListener('keydown', function(event) {
      if (event.ctrlKey) {
        switch (event.key.toLowerCase()) {
          case 'b': // Bold
            event.preventDefault();
            document.execCommand('bold');
            break;
          case 'u': // Underline
            event.preventDefault();
            document.execCommand('underline');
            break;
          case 'h': // Apply Highlight
            event.preventDefault();
            applyHighlight();
            break;
          case 'r': // Remove Highlight
            event.preventDefault();
            removeHighlight();
            break;
          case 's': // Save
            event.preventDefault();
            saveContent();
            break;
          case 'o': // Load file
            event.preventDefault();
            document.getElementById('fileLoad').click();
            break;
          case 'z': // Undo
            event.preventDefault();
            document.execCommand('undo');
            break;
          case 'y': // Redo
            event.preventDefault();
            document.execCommand('redo');
            break;
        }
      }
    });
  </script>
</body>
</html>
